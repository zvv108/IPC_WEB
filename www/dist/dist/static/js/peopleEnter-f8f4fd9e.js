import{V as ne,g as le,S as q,a as ae,P as se}from"./index-2df8a7f5.js";import{u as oe}from"./useNav-2cc20504.js";import{a3 as z,a4 as ie,d as $,r,v as ue,a as C,o as x,F as B,b as y,t as re,H as G,G as H,P as ce,u as A,e as o,w as m,f as L,U as de,I as j,J as K,_ as N,M as pe,g as M,W as ve,c as P,m as J}from"./index-98552006.js";import{S as Y,D as fe}from"./index-a2113198.js";import{d as me}from"./close-2eeed736.js";import{g as _e,a as ge,s as he,b as ye}from"./alarm-9138ebc0.js";var be=4294967295,ke=be-1,Ie=Math.floor,Ce=Math.min;function Fe(s,c,f,d){var _=0,b=s==null?0:s.length;if(b===0)return 0;c=f(c);for(var p=c!==c,i=c===null,T=z(c),a=c===void 0;_<b;){var R=Ie((_+b)/2),k=f(s[R]),E=k!==void 0,F=k===null,h=k===k,D=z(k);if(p)var I=d||h;else a?I=h&&(d||E):i?I=h&&E&&(d||!F):T?I=h&&E&&!F&&(d||!D):F||D?I=!1:I=d?k<=c:k<c;I?_=R+1:b=R}return Ce(b,ke)}function V(s,c,f){return Fe(s,c,ie(f))}const xe=s=>(j("data-v-d49d3a47"),s=s(),K(),s),Re={class:"time-bg-box"},Te={class:"title"},Ee={class:"time-bar-box"},Se=["onClick"],we={style:{height:"25px"}},Le=xe(()=>y("span",null,"\u65F6\u95F4\u9009\u62E9",-1)),Be={class:"text-center",style:{"padding-top":"10px"}},De={class:"btn-box"},Pe=$({__name:"TimePlanItem",props:{title:{type:String,require:!0},timeRangeList:{type:Array,require:!0,default:[]}},emits:["onChangeTimeRangeList"],setup(s,{emit:c}){const f=s,d=r(!1),_=r(null),b=r(),p=r([]),i=r(),T=r(),a=r([new Date(2023,1,1,0,0),new Date(2023,1,1,1,1)]),R=ue(()=>{const u=[];return f.timeRangeList.forEach(t=>{i.value?u.push({left:Math.round(t.start*i.value.clientWidth/1440)+"px",width:Math.round((t.end-t.start)*i.value.clientWidth/1440)+"px"}):u.push({})}),u}),k=u=>{const t=f.timeRangeList;_.value!=null&&t.splice(_.value,1);let v=V(t,u,l=>l.start),S=V(t,u,l=>l.end);t.splice(v,S-v),v=V(t,u,l=>l.start),S=V(t,u,l=>l.end);let g=null,n=null,e=u;return S<t.length&&(g=t[S],e.end<=g.end&&e.end>=g.start&&e.start>=g.start?e=null:e.end<g.end&&e.end>=g.start&&e.start<=g.start&&(e.end=g.end,t.splice(S,1))),v>0&&(n=t[v-1],u.end>n.end&&u.start<=n.end&&(e.start=n.start,t.splice(v-1,1))),e!=null&&(v=V(t,e,l=>l.start),t.splice(v,0,e)),t},E=(u,t)=>{_.value=t;const v=f.timeRangeList[t];T.value=u,a.value=[new Date(2023,1,1,Math.floor(v.start/60),v.start%60),new Date(2023,1,1,Math.floor(v.end/60),v.end%60)],d.value=!0},F=()=>{_.value!=null&&(d.value=!1,de(()=>{const u=f.timeRangeList;u.splice(_.value,1),c("onChangeTimeRangeList",u)}))},h=()=>{if(a.value.length>1){const u={start:a.value[0].getHours()*60+a.value[0].getMinutes(),end:a.value[1].getHours()*60+a.value[1].getMinutes()},t=k(u);c("onChangeTimeRangeList",t)}d.value=!1},D=()=>{_.value=null,T.value=b,a.value=[new Date(2023,1,1,0,0),new Date(2023,1,1,12,0)],d.value=!0},I=()=>{c("onChangeTimeRangeList",[])};return(u,t)=>{const v=C("IconifyIconOffline"),S=C("el-time-picker"),g=C("el-button"),n=C("el-popover");return x(),B("div",Re,[y("div",Te,re(s.title),1),y("div",Ee,[y("div",{class:"time-bar-wrap",ref_key:"timeWrapRef",ref:i},[(x(!0),B(G,null,H(s.timeRangeList,(e,l)=>(x(),B("div",{key:l,ref_for:!0,ref_key:"timeDivRefs",ref:p,class:"time-bar",style:ce(A(R)[l]),onClick:O=>E(p.value[l],l)},null,12,Se))),128)),o(n,{ref:"popoverRef","virtual-ref":T.value,visible:d.value,placement:"top",width:225,"virtual-triggering":""},{default:m(()=>[y("div",null,[y("div",we,[Le,o(v,{class:"float-right cursor-pointer",icon:A(me),onClick:t[0]||(t[0]=()=>d.value=!1)},null,8,["icon"])]),o(S,{style:{width:"200px"},modelValue:a.value,"onUpdate:modelValue":t[1]||(t[1]=e=>a.value=e),"is-range":"",size:"small",clearable:!1,format:"HH:mm","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65F6\u95F4","end-placeholder":"\u7ED3\u675F\u65F6\u95F4"},null,8,["modelValue"]),y("div",Be,[o(g,{link:"",onClick:F},{default:m(()=>[L(" \u5220\u9664 ")]),_:1}),o(g,{link:"",type:"primary",onClick:h},{default:m(()=>[L(" \u4FDD\u5B58 ")]),_:1})])])]),_:1},8,["virtual-ref","visible"])],512)]),y("div",De,[o(g,{link:"",type:"primary",ref_key:"addBtnRef",ref:b,onClick:D},{default:m(()=>[L("\u6DFB\u52A0")]),_:1},512),o(g,{link:"",type:"primary",onClick:I},{default:m(()=>[L("\u6E05\u7A7A")]),_:1})])])}}});const Ve=N(Pe,[["__scopeId","data-v-d49d3a47"]]),Ae={key:0},Me=$({__name:"index",props:{timeInfo:{type:Object,require:!0}},emits:["onChangeTimeInfo"],setup(s,{emit:c}){const f=s,d=r(f.timeInfo);pe(()=>f.timeInfo,p=>{p&&(d.value=f.timeInfo)});const _=p=>{switch(p){case 0:return"\u661F\u671F\u4E00";case 1:return"\u661F\u671F\u4E8C";case 2:return"\u661F\u671F\u4E09";case 3:return"\u661F\u671F\u56DB";case 4:return"\u661F\u671F\u4E94";case 5:return"\u661F\u671F\u516D";case 6:default:return"\u661F\u671F\u65E5"}},b=(p,i)=>{d.value.sSchedulesJson[i]=p,c("onChangeTimeInfo",d.value)};return(p,i)=>s.timeInfo&&s.timeInfo.sSchedulesJson?(x(),B("div",Ae,[(x(!0),B(G,null,H(s.timeInfo.sSchedulesJson,(T,a)=>(x(),B("div",{class:"time-bg-box",key:a},[o(Ve,{title:_(a),timeRangeList:T,onOnChangeTimeRangeList:R=>b(R,a)},null,8,["title","timeRangeList","onOnChangeTimeRangeList"])]))),128))])):M("",!0)}});const Ue=N(Me,[["__scopeId","data-v-5b5b70b3"]]),$e=s=>(j("data-v-56865e3c"),s=s(),K(),s),Ne={class:"page-content"},Oe={class:"flex items-center"},We=$e(()=>y("div",{class:"info-label"},"\u901A\u9053\u53F7",-1)),Xe={class:"flex"},qe={class:"video-box",style:{position:"relative"}},ze={class:"flex-col",style:{padding:"0 0 10px 30px"}},Je={key:0},Ye=$({__name:"peopleEnter",setup(s){const{isAdmin:c}=oe(),f=r(),d=r({...new ne,stretch:!0,showVoice:!1,showClose:!1,showScreenshot:!1}),_=r(),b=r([]),p=r([]),i=r({id:0,iSensitivityLevel:50,regionalInvasion:[]}),T=r({}),a=r(0),R=r(),k=r(),E=r("regionEdit"),F=r([]),h=r();ve(()=>{D()});function D(){_e().then(n=>{p.value=n.data,I()}),ge().then(n=>{F.value=n.data,I()}),le().then(n=>{let e=n.data.findIndex(l=>l.streamType==q.rgb);e>-1&&(R.value=n.data[e].mainStreamURL),e=n.data.findIndex(l=>l.streamType==q.ir),e>-1&&(k.value=n.data[e].mainStreamURL)})}function I(){p.value.length==2&&(a.value==0?i.value={...p.value[0]}:i.value={...p.value[1]}),F.value.length==2&&(a.value==0?h.value={...F.value[0]}:h.value={...F.value[1]});const n=[];i.value.regionalInvasion.forEach(e=>{n.push([e.iPositionX,e.iPositionY])}),b.value=n}function u(){f.value.validate((n,e)=>{n&&he(i.value).then(l=>{a.value==0?p.value[0]={...i.value}:p.value[1]={...i.value},J("\u8BBE\u7F6E\u6210\u529F",{type:"success"}),I()})})}function t(){ye(h.value).then(()=>{a.value==0?F.value[0]={...h.value}:F.value[1]={...h.value},J("\u8BBE\u7F6E\u6210\u529F",{type:"success"})})}function v(){_.value.clearShapes(!0)}function S(n){if(n.pointList.length>0){i.value.regionalInvasion=[];for(let e=0;e<n.pointList.length;e++){const l=n.pointList[e];i.value.regionalInvasion.push({id:e,iPositionX:l.x,iPositionY:l.y})}}}function g(n){h.value=n}return(n,e)=>{const l=C("el-option"),O=C("el-select"),Q=C("el-slider"),W=C("el-form-item"),U=C("el-button"),Z=C("el-form"),X=C("el-tab-pane"),ee=C("el-tabs"),te=C("el-card");return x(),P(te,{class:"page-box"},{default:m(()=>[y("div",Ne,[y("div",Oe,[We,o(O,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=w=>a.value=w),placeholder:"\u8BF7\u9009\u62E9",onChange:I},{default:m(()=>[o(l,{label:"\u53EF\u89C1\u5149\u901A\u9053",value:0}),o(l,{label:"\u7EA2\u5916\u901A\u9053",value:1})]),_:1},8,["modelValue"])]),o(ee,{type:"card",style:{padding:"30px 0 10px 60px"},modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=w=>E.value=w)},{default:m(()=>[o(X,{label:"\u533A\u57DF\u8BBE\u7F6E",name:"regionEdit"},{default:m(()=>[y("div",Xe,[y("div",qe,[a.value==0?(x(),P(Y,{key:0,class:"video-box","play-url":R.value,"onUpdate:play-url":e[1]||(e[1]=w=>R.value=w),options:d.value,"hide-controls":!0},null,8,["play-url","options"])):(x(),P(Y,{key:1,class:"video-box","play-url":k.value,"onUpdate:play-url":e[2]||(e[2]=w=>k.value=w),options:d.value,"hide-controls":!0},null,8,["play-url","options"])),o(fe,{ref_key:"drawShapeRef",ref:_,visible:!0,shape:A(ae).polygon,points:b.value,"broken-line-count":1,onDrawComplete:S},null,8,["shape","points"])]),y("div",ze,[o(se,{class:"pan-tilt","show-assist":!1,"show-speed":!1,"show-title":!1,"video-type":a.value},null,8,["video-type"]),o(Z,{style:{"padding-top":"10px"},ref_key:"formRef",ref:f,model:i.value,rules:T.value,"label-width":"60","hide-required-asterisk":""},{default:m(()=>[o(W,{label:"\u7075\u654F\u5EA6",prop:"iSensitivityLevel"},{default:m(()=>[o(Q,{modelValue:i.value.iSensitivityLevel,"onUpdate:modelValue":e[3]||(e[3]=w=>i.value.iSensitivityLevel=w),"show-input":"",min:0,max:100,"show-input-controls":!1,size:"small","input-size":"small"},null,8,["modelValue"])]),_:1}),o(W,{style:{"margin-top":"20px"}},{default:m(()=>[o(U,{type:"default",onClick:v},{default:m(()=>[L("\u6E05\u9664\u533A\u57DF")]),_:1}),A(c)?(x(),P(U,{key:0,type:"primary",onClick:u},{default:m(()=>[L(" \u4FDD\u5B58 ")]),_:1})):M("",!0)]),_:1})]),_:1},8,["model","rules"])])])]),_:1}),o(X,{label:"\u5E03\u9632\u65F6\u95F4",name:"protectTime"},{default:m(()=>[E.value=="protectTime"?(x(),B("div",Je,[o(Ue,{timeInfo:h.value,onOnChangeTimeInfo:g},null,8,["timeInfo"]),A(c)?(x(),P(U,{key:0,style:{margin:"20px 0 20px 20px"},type:"primary",onClick:t},{default:m(()=>[L(" \u4FDD\u5B58 ")]),_:1})):M("",!0)])):M("",!0)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}}});const et=N(Ye,[["__scopeId","data-v-56865e3c"]]);export{et as default};
